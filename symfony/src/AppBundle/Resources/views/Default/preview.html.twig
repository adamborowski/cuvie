{% extends 'AppBundle::base.html.twig' %}

{% block body %}
    <div class="container">
        <h1>{{ currency.id }}</h1>

        <div class="">
            <table class="table pull-right" style="width:auto">
                <tr>
                    <th>{{ 'tab.min'|trans }}</th>
                    <td>{{ attrs.min_value|number_format(4, '.', ',') }}</td>
                    <th>{{ 'tab.max'|trans }}</th>
                    <td>{{ attrs.max_value|number_format(4, '.', ',') }}</td>
                    <th>{{ 'tab.avg'|trans }}</th>
                    <td>{{ attrs.avg_value|number_format(4, '.', ',') }}</td>
                    <th>{{ 'tab.ratio'|trans }}</th>
                    <td>{{ currency.ratio }}</td>
                </tr>
            </table>
        </div>
        <p class="lead">{{ 'details.of'|trans }} {{ currency.label }}</p>

        <div class="a-chart" id="currency-chart"></div>
        <div class="alert alert-dismissible alert-success a-home-alert">
            <button type="button" class="close" data-dismiss="alert">Ã—</button>
            <h4>{{ 'preview.tip.header'|trans|raw }}</h4>
            {{ 'preview.tip'|trans|raw }}
        </div>
        <div class="a-chart-table-container">
            <table class="table table-striped table-hover a-chart-table">
                <thead>
                <tr>
                    <th>
                        {{ 'tab.date'|trans }}
                    </th>
                    <th>
                        {{ 'tab.value'|trans }}
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for entry in currency.entries|reverse %}
                    <tr>
                        <td>
                            {{ entry.date|date('Y-m-d') }}
                        </td>
                        <td>
                            {{ entry.value }}
                        </td>

                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% javascripts
    '@AppBundle/Resources/public/dygraph/dygraph-combined.js'
    '@AppBundle/Resources/public/jquery.dateformat.min.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script type="text/javascript">
        var data ={{ json|raw }};
        var chartData = data.map(function (x) {
            return [new Date(x.date), x.value]
        });


        $(function () {
            this.g = new Dygraph($('#currency-chart').get(0), chartData, {
                labels: ['{{'time'|trans }}', '{{ currency.id }}'],
                axes: {
                    y: {
                        axisLabelWidth: 20
                    }
                },
                valueFormatter: function (a, b, c, d, e, f) {
                    if (f == 0)
                        return DateFormat.format.date(a, 'yyyy-MM-dd');
                    return a;
                },
                interactionModel: Dygraph.Interaction.defaultModel,
                labelsDivWidth: 180,
                highlightCircleSize: 4,
                rightGap: 0,
                leftGap: 0,
                showRangeSelector: true,
                rangeSelectorHeight: 30,
                fillGraph: true,
                animatedZooms: true,
                fillAlpha: 0.8,
                color: '#079ddc'
            });

        });

    </script>
{% endblock %}
